<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bruker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>1603, 160 Logan Road</h1> 
    <div class="topnav">
        <a href="login.html">Login</a>
        <a href="user.html">Bruker</a>
        <a href="index.html">Hjem</a>
        <a href="vaskeregler.html">Vaskeregler</a>
        <a href="kryss.html">Kryss</a>
        <a href="sitater.html">Sitater</a>
        <a href="lardom.html">Australsk lærdom</a>
        <a href="guide.html">Skal du flytte hit?</a>
        <a href="admin.html">Admin</a>
    </div>
    <h2 id="greeting">Velkommen!</h2>
    <h3>Dine oppgaver for denne uken</h3>
    <div id="tasks"></div>
</body>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA_PRc6DM_i3X5lar_vcRtQyr1YVDRNq_o",
        authDomain: "logan-road.firebaseapp.com",
        databaseURL: "https://logan-road-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "logan-road",
        storageBucket: "logan-road.appspot.com",
        messagingSenderId: "659456402188",
        appId: "1:659456402188:web:1c77d675d130038141df29",
        measurementId: "G-LHYYB4FNXF"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            if (userDoc.exists()) {
                const userData = userDoc.data();
                document.getElementById('greeting').innerText = `Velkommen til siden din, ${userData.fornavn}!`;
            } else {
                console.log("No such document!");
            }
        } else {
            alert("Du må logge inn, babe")
            window.location.href = 'login.html'; // Redirect to login if no user is signed in
        }
    });
    document.addEventListener('DOMContentLoaded', async () => {
    const userId = auth.currentUser.uid;
    const userDoc = await getDoc(doc(db, 'users', userId));
    const userData = userDoc.data();

    const roomDoc = await getDoc(doc(db, 'vaskeliste', userData.assignedRoom));
    const roomData = roomDoc.data();

    const tasksDiv = document.getElementById('tasks');
    roomData.tasks.forEach((task, index) => {
        const taskElement = document.createElement('div');
        taskElement.innerHTML = `
            <input type="checkbox" id="task${index}" ${task.done ? 'checked' : ''} onchange="updateTaskStatus('${userData.assignedRoom}', ${index})">
            <label for="task${index}">${task.task}</label>
        `;
        tasksDiv.appendChild(taskElement);
    });
});

async function updateTaskStatus(roomId, taskIndex) {
    const roomDoc = await getDoc(doc(db, 'vaskeliste', roomId));
    const roomData = roomDoc.data();

    roomData.tasks[taskIndex].done = !roomData.tasks[taskIndex].done;
    await setDoc(doc(db, 'vaskeliste', roomId), roomData);

    const allTasksDone = roomData.tasks.every(task => task.done);
    if (allTasksDone) {
        await updateDoc(doc(db, 'vaskeliste', roomId), { status: true });
    }
}

</script>
</html>
